package Homework4;

import java.net.*;
import java.io.*;


/*
 * Homework 4:
 * Write a Java program that uses java.net.DatagramSocket which is 
 * able to send and receive java.net.DatagramPackets. 
 * The content of the packets will be Strings.
 *  Your class must be named DatagramSendReceive. 
 */


public class DatagramSendReceive extends Thread {

	
	static DatagramSocket socket;
	DatagramSendReceive receiveThread, sendThread;
	boolean isReceive;//true for receiving thread, false for sending thread
	
	//byte[] loopback = {(byte)127, (byte)0, (byte)0, (byte)1};
	byte[] ip; //= {(byte)192, (byte)168, (byte)1, (byte)109};
	
	
	
	public DatagramSendReceive(boolean isReceive){
		this.isReceive = isReceive;
	}
	
	public void setSocket(int port){
		try {
			createSocket(port);
		} catch (SocketException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
	
	public void setIP(int a, int b, int c, int d){
		ip = {(byte)a, (byte)b};
	}
	
	
	private void createSocket(int port) throws SocketException{
		socket = new DatagramSocket(port);	
	}

	
	public static DatagramPacket createDatagram(String message, int port, byte[] ip) throws UnknownHostException{
		InetAddress ip_address = InetAddress.getByAddress(ip);
		byte[] message_bytes = message.getBytes();
		DatagramPacket datagramPacket = new DatagramPacket(message_bytes, message_bytes.length, ip_address, port);
		return datagramPacket;
	}

	public void send(String message, int port, byte[] ip){

		while(true){
		try {
			DatagramPacket datagramPacket = createDatagram(message, port, ip);
			socket.send(datagramPacket);

			//DatagramPacket dgpacket = new DatagramPacket();

		} catch (SocketException e) {
			e.printStackTrace();
		} catch (UnknownHostException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
		}
	}
	
	
	public void startSendThread(){
		
	}
	
	public void startReceiveThread(){
		receiveThread = new DatagramSendReceive();
		receiveThread.start();
	}


	@Override
	public void run() {
		
		DatagramPacket receivePacket = new DatagramPacket(new byte[1024], 1024);
		try {
			createSocket(63000);
		} catch (SocketException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}
		while(true){
			try {

				socket.receive(receivePacket);

				String message = new String(receivePacket.getData());
				System.out.println(message);
				receivePacket = new DatagramPacket(new byte[1024], 1024);
				if(message.equals("bye")){
					socket.close();
				}
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
	}
}
